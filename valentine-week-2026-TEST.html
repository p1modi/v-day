<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Valentine's Week 2026 üíú [TEST MODE]</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #f5f1e8 0%, #e8dfd0 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        .test-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #ff6b6b;
            color: white;
            text-align: center;
            padding: 8px;
            font-size: 0.9rem;
            font-weight: bold;
            z-index: 2000;
        }

        .container {
            max-width: 500px;
            width: 100%;
            text-align: center;
            position: relative;
            z-index: 10;
            margin-top: 40px;
        }

        h1 {
            color: #6b4c8a;
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .date-display {
            color: #8b7aa8;
            font-size: 1.2rem;
            margin-bottom: 30px;
            font-style: italic;
        }

        .day-selector {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(107, 76, 138, 0.2);
        }

        .day-selector h3 {
            color: #6b4c8a;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .day-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .day-button {
            background: #6b4c8a;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Georgia', serif;
        }

        .day-button:active {
            transform: scale(0.95);
        }

        .day-button.collected {
            background: #d4c5b9;
            color: #6b4c8a;
        }

        .game-area {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 20px;
            padding: 40px 20px;
            min-height: 400px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(107, 76, 138, 0.2);
            backdrop-filter: blur(10px);
        }

        .instruction {
            color: #6b4c8a;
            font-size: 1.1rem;
            margin-bottom: 20px;
            line-height: 1.6;
            padding: 0 10px;
        }

        .sprite {
            position: absolute;
            font-size: 4rem;
            cursor: pointer;
            user-select: none;
            transition: transform 0.2s;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        .sprite:active {
            transform: scale(0.9);
        }

        .message {
            color: #8b7aa8;
            font-size: 1rem;
            margin-top: 20px;
            min-height: 30px;
            font-style: italic;
        }

        .success-message {
            color: #6b4c8a;
            font-size: 1.3rem;
            font-weight: bold;
            animation: fadeInScale 0.5s ease;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .particle {
            position: absolute;
            pointer-events: none;
            font-size: 1.5rem;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            pointer-events: none;
        }

        .memory-view {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .memory-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(107, 76, 138, 0.15);
        }

        .memory-card .sprite-display {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .memory-card .day-name {
            color: #6b4c8a;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .memory-card.collected {
            background: linear-gradient(135deg, #e8dfd0 0%, #d4c5b9 100%);
        }

        .memory-card.locked {
            opacity: 0.4;
            filter: grayscale(100%);
        }

        .button {
            background: #6b4c8a;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1rem;
            margin: 10px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(107, 76, 138, 0.3);
            transition: all 0.3s;
            font-family: 'Georgia', serif;
        }

        .button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(107, 76, 138, 0.3);
        }

        .reset-button {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(139, 122, 168, 0.3);
            color: #6b4c8a;
            border: 1px solid #8b7aa8;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 0.7rem;
            z-index: 1000;
        }

        .week-over-container {
            text-align: center;
        }

        .week-over-title {
            color: #6b4c8a;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-30px); }
        }

        .hide {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="test-banner">üîß TEST MODE - All challenges available üîß</div>
    
    <div class="container">
        <h1>Valentine's Week 2026</h1>
        <div class="date-display" id="dateDisplay"></div>
        
        <div class="day-selector">
            <h3>Choose a challenge to test:</h3>
            <div class="day-buttons" id="dayButtons"></div>
        </div>
        
        <div class="game-area" id="gameArea">
            <div class="instruction">Select a day above to test its challenge!</div>
        </div>
    </div>

    <button class="reset-button" onclick="resetProgress()">Reset Progress</button>

    <script>
        const days = [
            {
                date: new Date('2026-02-07'),
                name: "Rose Day",
                emoji: "üåπ",
                instruction: "Catch the rose when it turns red!",
                challenge: "colorChange",
                messages: {
                    wrong: "Wrong color! Wait for romance!",
                    miss: "Catch me if you can!",
                    success: "You caught me at my most beautiful! üåπ"
                }
            },
            {
                date: new Date('2026-02-08'),
                name: "Propose Day",
                emoji: "üíç",
                instruction: "The ring is nervous! Catch it before it runs away!",
                challenge: "runAway",
                messages: {
                    miss: "Will you... wait, I'm nervous!",
                    running: "Getting cold feet here!",
                    success: "Okay okay, you caught me! üíç"
                }
            },
            {
                date: new Date('2026-02-09'),
                name: "Chocolate Day",
                emoji: "üç´",
                instruction: "Don't let the chocolate melt!",
                challenge: "melt",
                messages: {
                    melting: "Don't let me melt away!",
                    miss: "Sweet but slippery!",
                    success: "Caught before I melted your heart! üç´"
                }
            },
            {
                date: new Date('2026-02-10'),
                name: "Teddy Day",
                emoji: "üß∏",
                instruction: "The teddy is shy! Catch it when it peeks out!",
                challenge: "peekaboo",
                messages: {
                    hiding: "Peek-a-boo!",
                    miss: "Too shy to come out fully!",
                    success: "You found me! So cozy now. üß∏"
                }
            },
            {
                date: new Date('2026-02-11'),
                name: "Promise Day",
                emoji: "ü§ù",
                instruction: "Tap the handshake 3 times to seal the promise!",
                challenge: "threeTaps",
                messages: {
                    first: "Can you commit?",
                    second: "Once more!",
                    third: "One last promise!",
                    success: "Sealed with three taps! ü§ù"
                }
            },
            {
                date: new Date('2026-02-12'),
                name: "Hug Day",
                emoji: "ü§ó",
                instruction: "Tap both hearts to bring them together!",
                challenge: "simultaneous",
                messages: {
                    waiting: "It takes two to hug!",
                    miss: "Bring us together!",
                    success: "Finally embraced! ü§ó"
                }
            },
            {
                date: new Date('2026-02-13'),
                name: "Kiss Day",
                emoji: "üíã",
                instruction: "Quick! Catch the fleeting kiss!",
                challenge: "fleeting",
                messages: {
                    miss: "*mwah* Missed!",
                    appearing: "Quick, while the moment lasts!",
                    success: "Caught that kiss! üíã"
                }
            },
            {
                date: new Date('2026-02-14'),
                name: "Valentine's Day",
                emoji: "‚ù§Ô∏è",
                instruction: "Collect all the love!",
                challenge: "finale",
                messages: {
                    collecting: "The whole week in one moment!",
                    success: "Love conquers all... challenges! ‚ù§Ô∏è"
                }
            }
        ];

        let currentDay = null;
        let gameState = {
            collected: JSON.parse(localStorage.getItem('valentineCollectedTest') || '[]'),
            currentChallenge: null
        };

        function saveProgress() {
            localStorage.setItem('valentineCollectedTest', JSON.stringify(gameState.collected));
        }

        function showMessage(text) {
            const messageEl = document.getElementById('message');
            if (messageEl) {
                messageEl.textContent = text;
                messageEl.className = 'message';
            }
        }

        function showSuccessMessage(text) {
            const messageEl = document.getElementById('message');
            if (messageEl) {
                messageEl.textContent = text;
                messageEl.className = 'message success-message';
            }
        }

        function createParticles(x, y, type = 'confetti') {
            const gameArea = document.getElementById('gameArea');
            const colors = ['#6b4c8a', '#8b7aa8', '#d4c5b9', '#f5f1e8', '#ffd700'];
            
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'confetti';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                const angle = (Math.PI * 2 * i) / 30;
                const velocity = 50 + Math.random() * 100;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;
                
                gameArea.appendChild(particle);
                
                particle.animate([
                    { transform: 'translate(0, 0) rotate(0deg)', opacity: 1 },
                    { transform: `translate(${tx}px, ${ty}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                ], {
                    duration: 1000 + Math.random() * 500,
                    easing: 'cubic-bezier(0, .9, .57, 1)'
                }).onfinish = () => particle.remove();
            }
        }

        function createHearts(x, y) {
            const gameArea = document.getElementById('gameArea');
            const hearts = ['üíú', 'üíó', 'üíñ', '‚ú®', 'üåü'];
            
            for (let i = 0; i < 15; i++) {
                const heart = document.createElement('div');
                heart.className = 'particle';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = x + 'px';
                heart.style.top = y + 'px';
                
                gameArea.appendChild(heart);
                
                const tx = (Math.random() - 0.5) * 200;
                const ty = -100 - Math.random() * 100;
                
                heart.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${tx}px, ${ty}px) scale(0.5)`, opacity: 0 }
                ], {
                    duration: 1500,
                    easing: 'ease-out'
                }).onfinish = () => heart.remove();
            }
        }

        function collectSprite(dayIndex) {
            if (!gameState.collected.includes(dayIndex)) {
                gameState.collected.push(dayIndex);
                saveProgress();
                updateDayButtons();
            }
            
            const day = days[dayIndex];
            showSuccessMessage(day.messages.success);
            
            setTimeout(() => {
                const gameArea = document.getElementById('gameArea');
                gameArea.innerHTML = `
                    <div class="instruction">Great job! üéâ</div>
                    <div class="message">Select another day to test more challenges!</div>
                `;
            }, 3000);
        }

        // Challenge: Color Change (Rose Day)
          function startColorChange(dayIndex) {
                const gameArea = document.getElementById('gameArea');
                const day = days[dayIndex];
                
                // Non-girly emojis: animals, nature, flowers, maps, symbols
                const emojis = ['‚òÄÔ∏è', 'üß∏', 'üêï', 'üåà', '‚≠ê', 'üåª', 'üçÄ', 'üå∏', 'üê±', 'ü¶Å', 'üê∫', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Ö', 'ü¶â', 'üê¢', 'üê¨', 'üêã', 'üåç', 'üåé', 'üåè', 'üó∫Ô∏è', '‚õ∞Ô∏è', 'üåã', 'üèîÔ∏è', 'üå≤', 'üå≥', 'üå¥', 'üåµ', 'üçÅ', 'üçÇ', 'üåæ', 'üåø', '‚òòÔ∏è', 'ü™®', 'üíé', 'üî•', 'üíß', '‚ùÑÔ∏è', '‚ö°', 'üåô', '‚òÅÔ∏è', 'üåä', 'üèµÔ∏è', 'üå∑', 'üåº', 'ü™ª', '‚öì', 'üß≠', '‚ô†Ô∏è', '‚ô£Ô∏è', '‚ô•Ô∏è', '‚ô¶Ô∏è', '‚òØÔ∏è', '‚≠ï', '‚ú≥Ô∏è', '‚ùáÔ∏è', 'üî∂', 'üî∑'];
                
                const totalEmojis = 120;
                let timerStarted = false;
                let timeLeft = 30;
                let timerInterval = null;
                let emojiElements = [];
                
                // Style game area for swiping
                gameArea.style.position = 'relative';
                gameArea.style.overflow = 'hidden';
                gameArea.style.touchAction = 'none';
                
                // Create timer display (hidden until first swipe)
                const timerDiv = document.createElement('div');
                timerDiv.id = 'timer';
                timerDiv.style.cssText = 'position:absolute;top:10px;right:10px;font-size:1.5rem;color:#6b4c8a;font-weight:bold;z-index:1000;opacity:0;transition:opacity 0.3s;';
                timerDiv.textContent = '‚è±Ô∏è 30s';
                gameArea.appendChild(timerDiv);
                
                // Create the rose (will be at bottom layer)
                const rose = document.createElement('div');
                rose.style.cssText = 'position:absolute;font-size:4rem;z-index:1;pointer-events:none;transition:all 0.5s;';
                rose.style.left = (30 + Math.random() * 40) + '%';
                rose.style.top = (30 + Math.random() * 40) + '%';
                rose.textContent = 'üåπ';
                rose.dataset.isRose = 'true';
                gameArea.appendChild(rose);
                
                // Create scattered emoji layers on top
                for (let i = 0; i < totalEmojis; i++) {
                    const emoji = document.createElement('div');
                    emoji.className = 'scattered-emoji';
                    emoji.style.cssText = 'position:absolute;font-size:' + (2 + Math.random() * 2) + 'rem;pointer-events:none;transition:all 0.4s ease-out;';
                    emoji.style.left = (Math.random() * 90) + '%';
                    emoji.style.top = (Math.random() * 85) + '%';
                    emoji.style.zIndex = 10 + Math.floor(i / 10); // Layered z-index
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.dataset.layer = Math.floor(i / 10);
                    gameArea.appendChild(emoji);
                    emojiElements.push(emoji);
                }
                
                // Shuffle array to randomize removal order
                emojiElements.sort(() => Math.random() - 0.5);
                
                let removedCount = 0;
                
                function getRemovalCount() {
                    // More emojis removed as time runs out
                    const timeRatio = 1 - (timeLeft / 30);
                    const baseRemoval = 2;
                    const maxRemoval = 12;
                    return Math.floor(baseRemoval + (maxRemoval - baseRemoval) * timeRatio);
                }
                
                function removeEmojis(x, y) {
                    const count = getRemovalCount();
                    let removed = 0;
                    
                    for (let i = 0; i < emojiElements.length && removed < count; i++) {
                        const emoji = emojiElements[i];
                        if (emoji.style.opacity !== '0') {
                            // Animate away from swipe point
                            const rect = emoji.getBoundingClientRect();
                            const areaRect = gameArea.getBoundingClientRect();
                            const emojiX = rect.left - areaRect.left;
                            const emojiY = rect.top - areaRect.top;
                            
                            const angle = Math.atan2(emojiY - y, emojiX - x);
                            const distance = 200 + Math.random() * 100;
                            const newX = emojiX + Math.cos(angle) * distance;
                            const newY = emojiY + Math.sin(angle) * distance;
                            
                            emoji.style.transform = 'translate(' + (newX - emojiX) + 'px, ' + (newY - emojiY) + 'px) rotate(' + (Math.random() * 360) + 'deg)';
                            emoji.style.opacity = '0';
                            removed++;
                            removedCount++;
                        }
                    }
                    
                    // Check if rose is revealed (most emojis gone)
                    if (removedCount >= totalEmojis - 5) {
                        rose.style.pointerEvents = 'auto';
                        rose.style.cursor = 'pointer';
                        rose.style.transform = 'scale(1.3)';
                        rose.style.filter = 'drop-shadow(0 0 10px #ff69b4)';
                        showMessage('There it is! Tap the üåπ');
                    }
                }
                
                // Handle swipe/touch
                let lastX = 0, lastY = 0;
                let isSwiping = false;
                
                function handleStart(e) {
                    e.preventDefault();
                    const point = e.touches ? e.touches[0] : e;
                    const areaRect = gameArea.getBoundingClientRect();
                    lastX = point.clientX - areaRect.left;
                    lastY = point.clientY - areaRect.top;
                    isSwiping = true;
                    
                    // Start timer on first interaction
                    if (!timerStarted) {
                        timerStarted = true;
                        timerDiv.style.opacity = '1';
                        timerInterval = setInterval(function() {
                            timeLeft--;
                            timerDiv.textContent = '‚è±Ô∏è ' + timeLeft + 's';
                            
                            if (timeLeft <= 5 && removedCount < totalEmojis - 10) {
                                // Help reveal if running out of time
                                removeEmojis(gameArea.offsetWidth / 2, gameArea.offsetHeight / 2);
                            }
                            
                            if (timeLeft <= 0) {
                                clearInterval(timerInterval);
                                // Auto-reveal rose
                                emojiElements.forEach(function(el) {
                                    el.style.opacity = '0';
                                });
                                rose.style.pointerEvents = 'auto';
                                rose.style.cursor = 'pointer';
                                rose.style.transform = 'scale(1.5)';
                                showMessage('Tap the üåπ!');
                            }
                        }, 1000);
                    }
                }
                
                function handleMove(e) {
                    if (!isSwiping) return;
                    e.preventDefault();
                    const point = e.touches ? e.touches[0] : e;
                    const areaRect = gameArea.getBoundingClientRect();
                    const x = point.clientX - areaRect.left;
                    const y = point.clientY - areaRect.top;
                    
                    // Only remove on significant movement
                    const dist = Math.sqrt((x - lastX) ** 2 + (y - lastY) ** 2);
                    if (dist > 20) {
                        removeEmojis(x, y);
                        lastX = x;
                        lastY = y;
                    }
                }
                
                function handleEnd() {
                    isSwiping = false;
                }
                
                gameArea.addEventListener('mousedown', handleStart);
                gameArea.addEventListener('mousemove', handleMove);
                gameArea.addEventListener('mouseup', handleEnd);
                gameArea.addEventListener('touchstart', handleStart, { passive: false });
                gameArea.addEventListener('touchmove', handleMove, { passive: false });
                gameArea.addEventListener('touchend', handleEnd);
                
                // Rose click handler
                rose.addEventListener('click', function(e) {
                    if (rose.style.pointerEvents === 'auto') {
                        clearInterval(timerInterval);
                        createHearts(e.clientX, e.clientY);
                        rose.style.animation = 'heartbeat 0.5s ease';
                        setTimeout(function() {
                            collectSprite(dayIndex);
                        }, 500);
                    }
                });
                
                showMessage('Swipe to clear the emojis!');
            }

        // Challenge: Run Away (Propose Day)
       function startRunAway(dayIndex) {
                const gameArea = document.getElementById('gameArea');
                const day = days[dayIndex];
                const rect = gameArea.getBoundingClientRect();
                
                let stage = 0;
                // Stages: 0=initial, 1=said hi, 2=disappeared first time, 3=thinking, 4=disappeared second time, 5=chasing, 6=center proposal, 7=ring appears
                
                const guy = document.createElement('div');
                guy.className = 'sprite';
                guy.textContent = 'üôáüèΩ‚Äç‚ôÇÔ∏è';
                guy.style.left = '50%';
                guy.style.top = '50%';
                guy.style.transform = 'translate(-50%, -50%)';
                gameArea.appendChild(guy);
                
                // Speech bubble
                const bubble = document.createElement('div');
                bubble.style.cssText = 'position:absolute;background:white;padding:10px 15px;border-radius:15px;box-shadow:0 2px 10px rgba(0,0,0,0.2);font-size:1.1rem;color:#6b4c8a;opacity:0;transition:opacity 0.3s;z-index:100;white-space:nowrap;';
                gameArea.appendChild(bubble);
                
                function showBubble(text, targetEl) {
                    bubble.textContent = text;
                    bubble.style.opacity = '1';
                    const guyRect = targetEl.getBoundingClientRect();
                    const areaRect = gameArea.getBoundingClientRect();
                    bubble.style.left = (guyRect.left - areaRect.left + 40) + 'px';
                    bubble.style.top = (guyRect.top - areaRect.top - 50) + 'px';
                }
                
                function hideBubble() {
                    bubble.style.opacity = '0';
                }
                
                function moveGuyRandom() {
                    const newX = 50 + Math.random() * (rect.width - 150);
                    const newY = 80 + Math.random() * (rect.height - 200);
                    guy.style.left = newX + 'px';
                    guy.style.top = newY + 'px';
                    guy.style.transform = 'translate(0, 0)';
                }
                
                let chaseCount = 0;
                let tapCount = 0;
                
                // Handle taps on empty area (for stage 2)
                gameArea.addEventListener('click', function(e) {
                    if (e.target === gameArea && stage === 2) {
                        tapCount++;
                        if (tapCount >= 3) {
                            // Reappear
                            stage = 3;
                            tapCount = 0;
                            guy.style.opacity = '1';
                            moveGuyRandom();
                        }
                    }
                });
                
                guy.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    if (stage === 0) {
                        // First tap - say hi
                        showBubble('Hi', guy);
                        stage = 1;
                        setTimeout(function() {
                            hideBubble();
                            setTimeout(function() {
                                guy.style.opacity = '0';
                                stage = 2;
                                showMessage('Where did he go? Tap around...');
                            }, 500);
                        }, 1500);
                        
                    } else if (stage === 3) {
                        // Second appearance - thinking
                        showBubble('I was thinking....', guy);
                        stage = 4;
                        setTimeout(function() {
                            hideBubble();
                            setTimeout(function() {
                                guy.style.opacity = '0';
                                setTimeout(function() {
                                    guy.style.opacity = '1';
                                    moveGuyRandom();
                                    stage = 5;
                                    showMessage('Catch him!');
                                }, 800);
                            }, 500);
                        }, 2000);
                        
                    } else if (stage === 5) {
                        // Chase stage
                        chaseCount++;
                        if (chaseCount < 5) {
                            moveGuyRandom();
                            guy.style.transition = 'all 0.3s ease';
                            showMessage(chaseCount < 3 ? 'Almost!' : 'So close!');
                        } else {
                            // Move to center for proposal
                            stage = 6;
                            guy.style.left = '50%';
                            guy.style.top = '40%';
                            guy.style.transform = 'translate(-50%, -50%)';
                            showMessage('');
                        }
                        
                    } else if (stage === 6) {
                        // Proposal
                        showBubble('Be mine? üíï', guy);
                        stage = 7;
                        
                        // Show ring
                        setTimeout(function() {
                            const ring = document.createElement('div');
                            ring.className = 'sprite';
                            ring.textContent = 'üíç';
                            ring.style.left = '70%';
                            ring.style.top = '50%';
                            ring.style.fontSize = '3rem';
                            ring.style.animation = 'heartbeat 1s ease infinite';
                            gameArea.appendChild(ring);
                            
                            ring.addEventListener('click', function(ev) {
                                ev.stopPropagation();
                                hideBubble();
                                guy.remove();
                                ring.remove();
                                
                                // Show married couple
                                const couple = document.createElement('div');
                                couple.className = 'sprite';
                                couple.textContent = 'üë´';
                                couple.style.left = '50%';
                                couple.style.top = '50%';
                                couple.style.transform = 'translate(-50%, -50%)';
                                couple.style.fontSize = '5rem';
                                gameArea.appendChild(couple);
                                
                                createHearts(ev.clientX, ev.clientY);
                                createParticles(ev.clientX, ev.clientY);
                                
                                setTimeout(function() {
                                    collectSprite(dayIndex);
                                }, 1500);
                            });
                            
                            showMessage('Tap the ring! üíç');
                        }, 1000);
                    }
                });
                
                // No initial instruction - let user discover
                showMessage('');
            }

        // Challenge: Melt (Chocolate Day)
        function startMelt(dayIndex) {
            const gameArea = document.getElementById('gameArea');
            const day = days[dayIndex];
            const rect = gameArea.getBoundingClientRect();
            
            const sprite = document.createElement('div');
            sprite.className = 'sprite';
            sprite.textContent = day.emoji;
            sprite.style.left = '50%';
            sprite.style.top = '0px';
            sprite.style.transform = 'translateX(-50%)';
            
            gameArea.appendChild(sprite);
            
            let position = 0;
            const fallSpeed = 2;
            let caught = false;
            
            showMessage(day.messages.melting);
            
            const fall = setInterval(() => {
                position += fallSpeed;
                sprite.style.top = position + 'px';
                
                if (position > rect.height - 100) {
                    clearInterval(fall);
                    if (!caught) {
                        sprite.remove();
                        showMessage(day.messages.miss);
                        setTimeout(() => startMelt(dayIndex), 1500);
                    }
                }
            }, 20);
            
            sprite.addEventListener('click', (e) => {
                if (!caught) {
                    caught = true;
                    clearInterval(fall);
                    createParticles(e.clientX, e.clientY);
                    sprite.style.animation = 'float 0.5s ease';
                    setTimeout(() => {
                        sprite.remove();
                        collectSprite(dayIndex);
                    }, 500);
                }
            });
        }

        // Challenge: Peekaboo (Teddy Day)
        function startPeekaboo(dayIndex) {
            const gameArea = document.getElementById('gameArea');
            const day = days[dayIndex];
            
            const sprite = document.createElement('div');
            sprite.className = 'sprite';
            sprite.textContent = day.emoji;
            sprite.style.left = '50%';
            sprite.style.top = '50%';
            sprite.style.transform = 'translate(-50%, -50%)';
            sprite.style.opacity = '0';
            
            gameArea.appendChild(sprite);
            
            showMessage(day.messages.hiding);
            
            let peekCount = 0;
            const peekInterval = setInterval(() => {
                sprite.style.opacity = '1';
                setTimeout(() => {
                    sprite.style.opacity = '0';
                }, 1000);
                peekCount++;
            }, 2000);
            
            sprite.addEventListener('click', (e) => {
                if (sprite.style.opacity === '1') {
                    clearInterval(peekInterval);
                    sprite.style.opacity = '1';
                    createHearts(e.clientX, e.clientY);
                    sprite.style.animation = 'bounce 0.5s ease';
                    setTimeout(() => {
                        sprite.remove();
                        collectSprite(dayIndex);
                    }, 500);
                }
            });
        }

        // Challenge: Three Taps (Promise Day)
        function startThreeTaps(dayIndex) {
            const gameArea = document.getElementById('gameArea');
            const day = days[dayIndex];
            
            const sprite = document.createElement('div');
            sprite.className = 'sprite';
            sprite.textContent = day.emoji;
            sprite.style.left = '50%';
            sprite.style.top = '50%';
            sprite.style.transform = 'translate(-50%, -50%)';
            
            gameArea.appendChild(sprite);
            
            let tapCount = 0;
            const messages = [day.messages.first, day.messages.second, day.messages.third];
            
            showMessage(messages[0]);
            
            sprite.addEventListener('click', (e) => {
                tapCount++;
                sprite.style.transform = 'translate(-50%, -50%) scale(1.2)';
                setTimeout(() => {
                    sprite.style.transform = 'translate(-50%, -50%) scale(1)';
                }, 200);
                
                if (tapCount < 3) {
                    showMessage(messages[tapCount]);
                    createParticles(e.clientX, e.clientY);
                } else {
                    createHearts(e.clientX, e.clientY);
                    sprite.style.animation = 'heartbeat 0.5s ease';
                    setTimeout(() => {
                        sprite.remove();
                        collectSprite(dayIndex);
                    }, 500);
                }
            });
        }

        // Challenge: Simultaneous (Hug Day)
        function startSimultaneous(dayIndex) {
            const gameArea = document.getElementById('gameArea');
            const day = days[dayIndex];
            const rect = gameArea.getBoundingClientRect();
            
            const heart1 = document.createElement('div');
            heart1.className = 'sprite';
            heart1.textContent = 'üíú';
            heart1.style.left = '20%';
            heart1.style.top = '50%';
            
            const heart2 = document.createElement('div');
            heart2.className = 'sprite';
            heart2.textContent = 'üíó';
            heart2.style.left = '80%';
            heart2.style.top = '50%';
            
            gameArea.appendChild(heart1);
            gameArea.appendChild(heart2);
            
            showMessage(day.messages.waiting);
            
            let tapped = { heart1: false, heart2: false };
            let lastTapTime = 0;
            
            const handleTap = (heartName, e) => {
                const now = Date.now();
                tapped[heartName] = true;
                lastTapTime = now;
                
                setTimeout(() => {
                    if (Date.now() - lastTapTime > 500) {
                        tapped = { heart1: false, heart2: false };
                    }
                }, 500);
                
                if (tapped.heart1 && tapped.heart2) {
                    createHearts(e.clientX, e.clientY);
                    heart1.style.animation = 'float 0.8s ease';
                    heart2.style.animation = 'float 0.8s ease';
                    
                    setTimeout(() => {
                        heart1.remove();
                        heart2.remove();
                        collectSprite(dayIndex);
                    }, 800);
                } else {
                    showMessage(day.messages.miss);
                }
            };
            
            heart1.addEventListener('click', (e) => handleTap('heart1', e));
            heart2.addEventListener('click', (e) => handleTap('heart2', e));
        }

        // Challenge: Fleeting (Kiss Day)
        function startFleeting(dayIndex) {
            const gameArea = document.getElementById('gameArea');
            const day = days[dayIndex];
            const rect = gameArea.getBoundingClientRect();
            
            let attempts = 0;
            
            const spawnKiss = () => {
                const sprite = document.createElement('div');
                sprite.className = 'sprite';
                sprite.textContent = day.emoji;
                sprite.style.left = Math.random() * (rect.width - 80) + 'px';
                sprite.style.top = Math.random() * (rect.height - 80) + 'px';
                sprite.style.opacity = '0';
                
                gameArea.appendChild(sprite);
                
                setTimeout(() => {
                    sprite.style.opacity = '1';
                    sprite.style.transition = 'opacity 0.3s';
                }, 100);
                
                showMessage(day.messages.appearing);
                
                const disappear = setTimeout(() => {
                    sprite.style.opacity = '0';
                    setTimeout(() => {
                        sprite.remove();
                        attempts++;
                        if (attempts < 8) {
                            showMessage(day.messages.miss);
                            setTimeout(spawnKiss, 1000);
                        } else {
                            setTimeout(spawnKiss, 500);
                        }
                    }, 300);
                }, 1500);
                
                sprite.addEventListener('click', (e) => {
                    clearTimeout(disappear);
                    sprite.style.opacity = '1';
                    createConfetti(e.clientX, e.clientY);
                    sprite.style.animation = 'spin 0.5s ease';
                    setTimeout(() => {
                        sprite.remove();
                        collectSprite(dayIndex);
                    }, 500);
                });
            };
            
            spawnKiss();
        }

        // Challenge: Finale (Valentine's Day)
        function startFinale(dayIndex) {
            const gameArea = document.getElementById('gameArea');
            const day = days[dayIndex];
            
            showMessage(day.messages.collecting);
            
            const allEmojis = days.map(d => d.emoji);
            let collected = 0;
            
            allEmojis.forEach((emoji, index) => {
                setTimeout(() => {
                    const sprite = document.createElement('div');
                    sprite.className = 'sprite';
                    sprite.textContent = emoji;
                    
                    const angle = (Math.PI * 2 * index) / allEmojis.length;
                    const radius = 100;
                    const x = 50 + Math.cos(angle) * 30;
                    const y = 50 + Math.sin(angle) * 30;
                    
                    sprite.style.left = x + '%';
                    sprite.style.top = y + '%';
                    sprite.style.animation = 'float 2s ease-in-out infinite';
                    sprite.style.animationDelay = (index * 0.1) + 's';
                    
                    gameArea.appendChild(sprite);
                    
                    sprite.addEventListener('click', (e) => {
                        collected++;
                        createParticles(e.clientX, e.clientY);
                        sprite.remove();
                        
                        if (collected === allEmojis.length) {
                            setTimeout(() => {
                                collectSprite(dayIndex);
                            }, 500);
                        }
                    });
                }, index * 200);
            });
        }

        function createConfetti(x, y) {
            createParticles(x, y, 'confetti');
        }

        function startChallenge(dayIndex) {
            const day = days[dayIndex];
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="instruction" id="instruction">${day.instruction}</div>
                <div class="message" id="message"></div>
            `;
            
            switch (day.challenge) {
                case 'colorChange': startColorChange(dayIndex); break;
                case 'runAway': startRunAway(dayIndex); break;
                case 'melt': startMelt(dayIndex); break;
                case 'peekaboo': startPeekaboo(dayIndex); break;
                case 'threeTaps': startThreeTaps(dayIndex); break;
                case 'simultaneous': startSimultaneous(dayIndex); break;
                case 'fleeting': startFleeting(dayIndex); break;
                case 'finale': startFinale(dayIndex); break;
            }
        }

        function updateDayButtons() {
            const dayButtonsContainer = document.getElementById('dayButtons');
            dayButtonsContainer.innerHTML = '';
            
            days.forEach((day, index) => {
                const button = document.createElement('button');
                button.className = 'day-button';
                if (gameState.collected.includes(index)) {
                    button.classList.add('collected');
                }
                button.textContent = `${day.emoji} ${day.name}`;
                button.onclick = () => startChallenge(index);
                dayButtonsContainer.appendChild(button);
            });
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress?')) {
                gameState.collected = [];
                saveProgress();
                updateDayButtons();
                const gameArea = document.getElementById('gameArea');
                gameArea.innerHTML = `
                    <div class="instruction">Progress reset! Select a day above to test.</div>
                `;
            }
        }

        function init() {
            const dateDisplay = document.getElementById('dateDisplay');
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            dateDisplay.textContent = dateStr;
            
            updateDayButtons();
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
